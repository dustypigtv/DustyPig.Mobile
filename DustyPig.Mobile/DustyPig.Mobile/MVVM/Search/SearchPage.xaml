<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns:viewmodels="clr-namespace:DustyPig.Mobile.MVVM.Search" 
             xmlns:ffimages="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms" 
             xmlns:models="clr-namespace:DustyPig.API.v3.Models;assembly=DustyPig.API" 
             xmlns:controls="clr-namespace:DustyPig.Mobile.Controls"
             x:Class="DustyPig.Mobile.MVVM.Search.SearchPage"
             x:DataType="viewmodels:SearchViewModel">

    <Shell.SearchHandler>
        <controls:CustomSearchHandler
            x:Name="SB"
            DoQuery="CustomSearchHandler_DoQuery"
            Placeholder="Enter search term" />
    </Shell.SearchHandler>

    <ContentPage.Content>
        <ScrollView>
            <StackLayout 
                Margin="12,12,12,0"
                Orientation="Vertical">

                <ActivityIndicator
                    IsRunning="{Binding IsBusy}" />

                <CollectionView
                    Margin="0,0,0,8"
                    HeightRequest="160"
                    ItemSizingStrategy="MeasureFirstItem"
                    ItemsSource="{Binding AvailableItems}">

                    <CollectionView.EmptyView>
                        <StackLayout
                            HorizontalOptions="CenterAndExpand"
                            VerticalOptions="CenterAndExpand">
                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                TextColor="White"
                                HorizontalTextAlignment="Center"
                                Text="{Binding MediaEmptyString}" />
                        </StackLayout>
                    </CollectionView.EmptyView>
                    
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout 
                            Orientation="Horizontal"
                            ItemSpacing="16"/>
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate
                            x:DataType="models:BasicMedia">

                            <ffimages:CachedImage 
                                Source="{Binding ArtworkUrl}"
                                HeightRequest="150"
                                WidthRequest="100"
                                Aspect="AspectFit"
                                ErrorPlaceholder="resource://DustyPig.Mobile.Images.poster_error.png"
                                LoadingPlaceholder="resource://DustyPig.Mobile.Images.poster_placeholder.png">

                                <ffimages:CachedImage.GestureRecognizers>
                                    <TapGestureRecognizer 
                                        Tapped="Poster_Tapped" 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:SearchViewModel}}, Path=ItemTappedCommand}"
                                        CommandParameter="{Binding}" />
                                </ffimages:CachedImage.GestureRecognizers>

                            </ffimages:CachedImage>

                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                </CollectionView>


            </StackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>